# Техническое задание

## Сервис бронирования парковки «ParkApp»

---

### Общие требования

Система представляет собой HTTP API со следующими требованиями к бизнес-логике:

* *Для сотрудников*:
	* доступ по логину (добавляется офис-менеджером в систему);
	* запрос списка доступных для бронирования мест на выбранную дату вместе со схемой парковки;
	* просмотр, создание, перенос и отмена бронирований парковочных мест на корпоративной парковке;
	* учёт и ведение бронирований с выводом остатка дней в текущем месяце;
* *Для офис-менеджера*:
	* регистрация по секретному коду;
	* добавление и удаление логинов сотрудников в систему;
	* добавление и удаление схемы парковки с кодовыми обозначениями парковочных мест.
	* добавление и удаление парковочных мест;
	* установка лимитов на количество бронирований в месяц для сотрудников;
	* установка времени, шаблона письма и адреса получателя для автоматической повторяющейся отправки информации о бронированиях (см. ниже);
* Автоматическая повторяющаяся отправка электронного письма на заданный адрес. Письмо содержит список регистрационных номеров автомобилей из списка бронирований на следующие сутки;
### Абстрактная схема взаимодействия с системой

Ниже представлена абстрактная бизнес-логика взаимодействия пользователя с системой:

1. Со стороны офис-менеджера:
	1. Пользователь регистрируется в системе используя секретный код.
	2. Пользователь загружает в систему схему парковки.
	3. Пользователь добавляет парковочные места в систему с указанием их кодового обозначения.
	4. Пользователь устанавливает лимит доступных сотрудникам бронирований в месяц.
	5. Пользователь задает шаблон электронного письма, адрес получателя и время повторяющейся отправки письма в формате HH:MM.
	6. Пользователь добавляет и удаляет сотрудников по запросу.
2. Со стороны сотрудников:
	1. Пользователь единожды запрашивает у офис-менеджера добавление его логина в систему.
	2. Пользователь смотрит свой доступный баланс бронирований на текущий месяц.
	3. Пользователь выбирает дату, на которое он хочет оформить бронирование и получает список доступных для брони парковочных мест вместе со схемой парковки.
	4. Пользователь выбирает парковочное место и вводит данные своего автомобиля.
	5. Пользователь успешно бронирует место, если на момент бронирования у него есть > 0 дней на балансе. 
	6. Пользователь запрашивает список бронирований и убеждается, что бронирование создано.

Примечания:

- пункт 1.1 предполагает наличие кода на момент начала пользования систем;
- пункт 2.1 не является частью системы;

### Сводное HTTP API

Приложение бронирования парковки должно предоставлять следующие HTTP-хендлеры:

*Для офис-менеджеров*:
* `POST /api/managers/register` — регистрация офис-менеджера.
* `GET /api/managers/employees` — получение списка сотрудников.
* `GET /api/managers/employees/<login>` — получение баланса сотрудника, месячного лимита и истории бронирований.
* `POST /api/managers/employees` — добавление сотрудника.
* `DELETE /api/managers/employees/<login>` — удаление сотрудника.
* `POST /api/managers/parking-scheme` — загрузка схемы парковки.
* `POST /api/managers/parking-spots` — добавление парковочных мест.
* `GET /api/managers/parking-spots` — получение списка парковочных мест.
* `DELETE /api/managers/parking-spots/<spot_code>` — удаление парковочного места.
* `POST /api/managers/booking-limits` — установка лимитов бронирования для всех сотрудников.
*  `POST /api/managers/booking-limits/<employee_login>` — установка лимита бронирования для отдельного сотрудника.
* `POST /api/managers/email-settings` — установка настроек повторяющейся пересылки номеров автомобилей.

*Для сотрудников*:
* `GET /api/employees/booking-balance` — получение своего баланса бронирования.
* `GET /api/employees/available-spots` — получение доступных мест для бронирования.
* `POST /api/employees/book-spot` — бронирование места.
* `POST /api/employees/bookings/<id>/cancel` — отмена бронирования.
* `GET /api/employees/bookings` — получение истории своих бронирований.

### Общие ограничения и требования

- Формат даты: `2023-08-15" (ISO 8601)


>Далее вам нужно самостоятельно указать ограничения и нефункциональные требования полученные из диалога с заказчиком

## Эндпоинты офис-менеджера
#### **Регистрация офис-менеджера**

Хендлер: `POST /api/managers/register`.

Регистрирует офис-менеджера в системе.

Формат запроса:
```http
POST /api/managers/register HTTP/1.1
Content-Type: application/json
Content-Length: ...

{
    "secret_code": "your_secret_code_here"
}
```

Возможные коды ответа:

- `200` — успешная регистрация офис-менеджера.

К каждому последующему запросу должен прилагаться заголовок `"X-Manager-Login"` с логином менеджера, который мы зарегистрировали на предыдущем шаге.
#### **Получение списка сотрудников**

Хендлер: `GET /api/managers/employees`.

Получает список всех зарегистрированных сотрудников в системе.

Возможные коды ответа:

- `200` — успешное получение списка сотрудников.

  Формат ответа:

```http
200 OK HTTP/1.1
Content-Type: application/json

{
	"employees": [
		"login1",
		"login2"
		...
	]
}
```

#### **Получение информации о сотруднике**

Хендлер: `GET /api/managers/employees/<login>`.

Получает баланс бронирования, месячный лимит и историю бронирований для определенного сотрудника.

Параметры URL:

- `login` (строка, обязательный): Логин сотрудника.

Возможные коды ответа:

- `200` — успешное получение информации о сотруднике.

  Формат ответа:

```http
200 OK HTTP/1.1
Content-Type: application/json

{
	"balance": 50,
	"monthly_limit": 10,
	"bookings": [
		{ /* бронирование 1 */ },
		{ /* бронирование 2 */ },
		...
	]
}
```

Формат бронирования:
```json
	{
		"id": "string",
		"spot_code": "string",
		"date": "2023-08-15",
		"car_plate_number": "п555мн161",
		"status": "canceled"
	}
```

#### **Добавление сотрудника**

Хендлер: `POST /api/managers/employees`.

Добавляет нового сотрудника в систему.

Формат запроса:
```http
POST /api/managers/employees HTTP/1.1
Content-Type: application/json
Content-Length: ...

{
    "login": "employee_login_here"
}
```

Возможные коды ответа:

- `200` — сотрудник добавлен успешно.

#### **Удаление сотрудника**

Хендлер: `DELETE /api/managers/employees/<login>`.

Удаляет сотрудника из системы на основе его логина.

Параметры URL:

- `login` (строка, обязательный): Логин сотрудника.

Формат запроса:
```http
DELETE /api/managers/employees/<login> HTTP/1.1
```

Возможные коды ответа:

- `200` — сотрудник удален успешно.

#### **Загрузка схемы парковки**

Хендлер: `POST /api/managers/parking-scheme`.

Загружает схему парковки в систему.

Формат запроса:
```http
POST /api/managers/parking-scheme HTTP/1.1
Content-Type: multipart/form-data
Content-Length: ...

<file data here>
```

Возможные коды ответа:

- `200` — схема парковки загружена успешно.

#### **Добавление парковочных мест**

Хендлер: `POST /api/managers/parking-spots`.

Добавляет новые парковочные места в систему.

Формат запроса:
```http
POST /api/managers/parking-spots HTTP/1.1
Content-Type: application/json
Content-Length: ...

{
    "spots": ["spot_code1", "spot_code2", ...]
}
```

Возможные коды ответа:

- `200` — парковочные места добавлены успешно.

#### **Получение списка парковочных мест**

Хендлер: `GET /api/managers/parking-spots`.

Получает список всех доступных парковочных мест на корпоративной парковке.

Возможные коды ответа:

- `200` — успешное получение списка парковочных мест.

  Формат ответа:

```http
200 OK HTTP/1.1
Content-Type: application/json

{
	"parking_spots": [
		"spot_code1",
		"spot_code2"
		...
	]
}
```

#### **Удаление парковочного места**

Хендлер: `DELETE /api/managers/parking-spots/<spot_code>`.

Удаляет парковочное место из системы на основе его кодового обозначения.

Параметры URL:

- `spot_code` (строка, обязательный): Кодовое обозначение парковочного места.

Формат запроса:
```http
DELETE /api/managers/parking-spots/<spot_code>` HTTP/1.1
```

Возможные коды ответа:

- `200` — парковочное место удалено успешно.

#### **Установка лимитов бронирования для всех сотрудников**

Хендлер: `POST /api/managers/booking-limits`.

Устанавливает месячные лимиты бронирования для всех зарегистрированных сотрудников.

Формат запроса:
```http
POST /api/managers/booking-limits HTTP/1.1
Content-Type: application/json
Content-Length: ...

{
    "limit": 10
}
```

Возможные коды ответа:

- `200` — лимиты бронирования установлены успешно.

#### **Установка лимита бронирования для отдельного сотрудника**

Хендлер: `POST /api/managers/booking-limits/<employee_login>`.

Устанавливает месячный лимит бронирования для определенного сотрудника.

Параметры URL:

- `employee_login` (строка, обязательный): Логин сотрудника.

Формат запроса:
```http
POST /api/managers/booking-limits/<employee_login> HTTP/1.1
Content

Type: application/json
Content-Length: ...

{
    "limit": 5
}
```

Возможные коды ответа:

- `200` — лимит бронирования для сотрудника установлен успешно.

#### **Установка настроек повторяющейся отправки номеров автомобилей**

Хендлер: `POST /api/managers/email-settings`.

Устанавливает настройки пересылки писем на пост охраны. Используйте директиву `%s` для подстановки строки со списком номеров автомобилей. 

Формат запроса:
```http
POST /api/managers/email-settings` HTTP/1.1
Content

Type: application/json
Content-Length: ...

{
    "send_time": "HH:MM",
    "receiver_email": "okhrana@yandex.ru",
    "email_template": "Добрый день! Номера на завтра %s"
}
```

Возможные коды ответа:

- `200` — лимит бронирования для сотрудника установлен успешно.

## Эндпоинты сотрудника

К каждому запросу должен прилагаться заголовок `"X-Employee-Login"` с логином пользователя.
#### **Получение текущего баланса бронирования**

Хендлер: `GET /api/employees/booking-balance`.

Получает текущий баланс бронирования для сотрудника.

Возможные коды ответа:

- `200` — успешное получение текущего баланса бронирования.

  Формат ответа:

```http
200 OK HTTP/1.1
Content-Type: application/json

{
	"balance": 5
}
```

#### **Получение доступных мест для бронирования**

Хендлер: `GET /api/employees/available-spots`.

Получает список доступных мест для бронирования на выбранную дату.

Возможные коды ответа:

- `200` — успешное получение списка доступных мест для бронирования.

  Формат ответа:

```http
200 OK HTTP/1.1
Content-Type: application/json

{
	"date": "2023-08-15",
	"available_spots": [
		"spot_code1",
		"spot_code2"
		...
	]
}
```

#### **Бронирование места**

Хендлер: `POST /api/employees/book-spot`.

Бронирует выбранное место для сотрудника. Бронированию ставится статус `"booked"`

Формат запроса:
```http
POST /api/employees/book-spot HTTP/1.1
Content-Type: application/json
Content-Length: ...

{
    "spot_code": "spot_code_here",
    "car_plate_number": "car_plate_number"
}
```

Возможные коды ответа:

- `200` — место успешно забронировано.

#### **Получение истории бронирований**

Хендлер: `GET /api/employees/bookings`.

Получает историю бронирований для сотрудника.

Возможные коды ответа:

- `200` — успешное получение истории бронирований.

  Формат ответа:

```http
200 OK HTTP/1.1
Content-Type: application/json

{
	"bookings": [
		{ /* бронирование 1 */ },
		{ /* бронирование 2 */ },
		...
	]
}
```

Формат бронирования:
```json
	{
		"id": "string",
		"spot_code": "string",
		"date": "2023-08-15",
		"car_plate_number": "п555мн161",
		"status": "canceled"
	}
```

#### **Отмена бронирования**

Хендлер: `POST /api/employees/bookings/<id>/cancel`

Отменяет бронирование. Бронированию ставится статус `"canceled"`

Возможные коды ответа:

- `200` — успешное получение истории бронирований.

  Формат ответа:
### Конфигурирование сервиса накопительной системы лояльности

Сервис должн поддерживать конфигурирование следующими методами:

- адрес и порт запуска сервиса: переменная окружения ОС `RUN_ADDRESS` или флаг `-a`
- секретный код для регистрации офис-менеджера: переменная окружения ОС `SECRET_CODE` или флаг `-s`
