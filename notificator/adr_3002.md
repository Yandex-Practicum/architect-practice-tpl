#### ID: ADR-3001

#### Дата: 2023.10.08

#### Статус: Предложено

#### Участники:
* Абдрахманов Марат

#### Решения:
* Multiplexer & Sender Service и шлюзы для SMS, Push и EMail, с которыми он работает, являются отдельными микросервисами.
* Multiplexer & Sender Service состоит из следующих компонент:
    * Kafka Consumer - считывает данные из Kafka (топик send_notify).
    * Notify Processor - обработчик считанного уведомления.
    * Sender Service - сервис, который отвечает за отправку уведомления.
    * gRPC Client - клиент для связи по gRPC с шлюзами.
* SMS, Push и EMail шлюзы имеют сходную структуру:
    * gRPC Service - сервис для приема данных по gRPC.
    * SMS/Push/EMail Service - сервис для подготовки уведомления для внешнего сервиса, с которым он будет работать. В рамках эти сервисов решаются вопросы связанные с особенностями работы с конкретными сервисами, учитывающими ограничение количества символов в СМС, стоимость СМС, лимиты пуш-очередей провайдеров, возможность попадания e-mail в спам и т.д.
    * HTTP Client - клиент для отправки сообщения во внешний сервис. Предполагаем, что они позволят работать с собой по REST.

#### Контекст:
Необходимо высокоуровнево спроектировать Multiplexer & Sender Service и шлюзы для доступа к внешним SMS, Push и EMail сервисам уведомлений. Необходимо учесть Архитектурные решения и Принципы проектирования из ADR-001. 

#### Последствия:

#### Положительные:
* В случае повышения нагрузки можно дополнительно запускать копии Multiplexer & Sender Service и шлюзов, т.к. они не хранят состояние.
* При необходимости можно вводить в работу дополнительные шлюзы для тестирования альтернативных внешних сервисов рассылки.
* Упрощение тестирование отдельных компонент системы.

#### Отрицательные:
* Дополнительно сетевое взаимодействие по gRPC может быть причиной ряда проблем, которые необходимо учесть (см. отрицательные последствия в ADR-001).
