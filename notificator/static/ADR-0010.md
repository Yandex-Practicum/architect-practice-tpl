#### ID: [ADR-0010](ADR-0010.md)

#### Дата: 12.10.2023

#### Статус: Предложено

#### Участники:
* Емельянов Денис Владимирович

#### Решения:
* Использование очереди сообщений Kafka как брокера сообщений между API Gateway
* Использование очереди сообщений Kafka как брокера сообщений между сервисом нотификации и сервисами отправки сообщений в конкретные каналы

#### Контекст:
* Для увеличения скорости обработки пользовательских запросов об отправке сообщения будем использовать брокер сообщений 
[ADR_0004](ADR-0004.md)
* Для отправки в разные каналы требуется поддержка маршрутизации сообщений
* Для адаптации под нагрузку требуется возможность масштабирования очередей сообщений
* Желательно, чтобы решение имело открытый исходный код

* Среди открытых популярных реализаций есть варианты: RabbitMQ, Kafka, ActiveMQ
 https://medium.com/huawei-developers/rabbitmq-kafka-activemq-which-message-broker-to-choose-6c6b127e46ef#:~:text=RabbitMQ%20excels%20in%20low%2Dlatency,protocols%20and%20advanced%20enterprise%20features.

| Брокер   | Маршрутизация сообщений                                     | Масштабирование                            | Производительность                                    |
|----------|-------------------------------------------------------------|--------------------------------------------|-------------------------------------------------------|
| Kafka    | Использует базовый способ маршрутизации через разные топики | Посредством разделения топиков на партиции | Превосходит остальнёые варианты под большой нагрузкой |
| RabbitMQ | Имеет более гибкие настройки для маршрутизации              | Посредством mirrors queue                  | Имеет наименьшую задержку                             |
| ActiveMQ | Использует механизмы селекторов и топиков                   | Master-Slave модель                        | Хуже справляется с нагрузкой сем Kafka, но достаточно |

* Поскольку все три варианта достаточно хорошо подходят, использовать будем Kafka ввиду большего опыта работы с этим брокером у команды разработчиков и операционистов

#### Последствия:

#### Положительные:
* Опыт работы с Kafka снизит риски при настройке и сопровождении

#### Отрицательные:
* Kafka более "громоздкая" и требовательная к настройке, чем остальные варианты