#### ID: ADR-001

#### Дата: 12.10.2023

#### Статус: Предложено

#### Участники:
* Евгений Климов

## Выбор технологии для отправки оповещений

#### Решения:
- Email:  Для отправки электронных писем было принято решение использовать стандартный протокол SMTP (Simple Mail Transfer Protocol). Для обеспечения надежной доставки и обработки электронных писем будет использоваться библиотека JavaMail API.
- SMS: Для отправки SMS-сообщений было принято решение интегрировать систему с популярным SMS-шлюзом Twilio. Twilio предоставляет надежный сервис для отправки SMS-сообщений и обеспечивает масштабируемость и отслеживание доставки.
- Push-уведомления: Для отправки push-уведомлений на мобильные устройства под управлением Android и iOS было принято решение использовать Firebase Cloud Messaging (FCM). FCM обеспечивает кросс-платформенную поддержку и надежную доставку уведомлений.

#### Контекст:
Решение было принято в контексте создания подсистемы для отправки оповещений о событиях в существующей архитектуре. Подсистема должна обеспечивать возможность рассылки оповещений по трём каналам связи: email, SMS и push-уведомления для мобильных устройств. Это обусловлено потребностью в надежной и масштабируемой архитектуре для оповещений, которая не зависит от компонентов системы, отправляющих оповещения.

Дополнительно, подсистема должна учитывать пользовательские настройки для каждого канала связи, такие как включение или выключение, адрес/номер/логин получателя, и применять их при рассылке уведомлений. Важно отметить, что внешние системы не пишут в базу данных нашей системы, не имеют прямого доступа к SMS-рассылке и не знают о подробностях реализации отправки оповещений.

**Обоснование:** Выбор указанных технологий обусловлен следующим:
- Email: SMTP является стандартным и широко принятым протоколом для отправки электронных писем. JavaMail API предоставляет удобный способ взаимодействия с SMTP-сервером и обработки электронных сообщений. Это обеспечивает совместимость с различными почтовыми сервисами и возможность кастомизации.
- SMS: Twilio предоставляет удобный API для отправки SMS, а также инструменты для отслеживания статуса доставки сообщений. Интеграция с Twilio обеспечивает отслеживание и отчетность по SMS-оповещениям.
- Push-уведомления: FCM - это распространенная и надежная платформа для отправки push-уведомлений. Она обеспечивает быструю доставку уведомлений на мобильные устройства под управлением Android и iOS, и предоставляет возможность сегментации аудитории.

**Альтернативы:** В качестве альтернатив можно рассмотреть следующие варианты:

- Email: Вместо SMTP можно использовать API почтовых сервисов, таких как SendGrid или Amazon SES. Однако, SMTP обеспечивает большую гибкость и контроль.
- SMS: Для отправки SMS можно также рассмотреть другие SMS-шлюзы, такие как Nexmo или Plivo. Однако, Twilio предоставляет удобные инструменты для разработки и мониторинга.
- Push-уведомления: Вместо FCM можно использовать альтернативные сервисы, такие как Apple Push Notification Service (APNs) для iOS или другие мобильные уведомительные платформы. FCM был выбран из-за его популярности и кросс-платформенной поддержки.

#### Последствия:

***Положительные:***
- Использование нескольких каналов связи обеспечивает повышенную надежность в доставке оповещений. В случае сбоя на одном из каналов, система может автоматически переключиться на другой, что уменьшает риск недоставки важных сообщений.
- Поддержка различных каналов связи (email, SMS, push-уведомления) позволяет достичь большей аудитории пользователей, так как каждый предпочитает оповещения через разные каналы. Это увеличивает шансы на успешную доставку сообщений до конечных пользователей.
- Использование разных каналов позволяет проводить более точную сегментацию аудитории и персонализировать оповещения. Это способствует улучшению пользовательского опыта и реакции на оповещения.
- Работа с разными каналами связи уменьшает вероятность отказа в доставке. Например, если электронное письмо попадает в спам, SMS или push-уведомления могут быть более надежными способами доставки сообщений.
- Использование email, SMS и push-уведомлений покрывает различные типы устройств и операционных систем, что обеспечивает универсальность в доставке оповещений.

***Отрицательные:***
- Дополнительные затраты на интеграцию и поддержание выбранных технологий.
- Работа с несколькими каналами связи и разными технологиями может привести к увеличению сложности системы, что может повысить трудозатраты на разработку, тестирование и поддержание.
- Потребность в обработке возможных ограничений каждого канала связи, таких как ограничение символов в SMS, стоимость SMS и лимиты пуш-очередей провайдеров.
- Использование различных каналов связи подразумевает потенциальные угрозы безопасности. Например, несанкционированный доступ к учетным данным SMTP-сервера для отправки электронных писем или утечки конфиденциальных данных через SMS-сообщения.
- Работа с разными технологиями также подразумевает разные механизмы отклика на сбои. В случае отказа одного из каналов связи, система должна быть способной быстро переключиться на другой канал или предоставить информацию о сбое пользователям.
