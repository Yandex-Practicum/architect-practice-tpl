# Технический проект "Сервис отправки оповещений"

> Это фрагмент Технического проекта, который нужно заполнить в рамках практического задания темы "Технический проект".
---

## Текущая архитектура

В текущей архитектуре у нас есть мобильное приложение, которое общается с компонентом "Controller", а он в свою очередь делает запросы к "Foo" и "Bar".

![alt text](static/current_arch.svg)


## Целевая архитектура

### Диаграмма контекста (C1):

![C1](static/c1.svg)

Предполагается, что любой из существующих компонентов может отправить оповещение адресату. При этом существующие каналы связи и предпочтения по их использованию известны системе оповещений, компоненты остальной системы знать это не должны.

### Диаграмма контейнеров (C2):

![C2](static/c2.svg)

Для реализации подсистемы выбрана event-driven архитектура с использованием внешних сервисов для доставки оповещений клиентам. [ADR-004](adr-004.md) 
Компоненты системы, в виде сервисов, будут изолированы в контейнерах docker, оркестрируемых Kubernetes [ADR-003](adr-003.md)  
В подсистеме будет реализовано хранение необходимых данных (данные адресатов, настройки каналов оповещения) [ADR-006](adr-006.md). 
Для буферизации внутренних данных подсистемы и недопущения их потери при высоких нагрузках, будет использоваться брокер сообщений [ADR-005](adr-005.md).
Получение данных для рассылки и настроек работы системы будет выполняться с использованием RESTful API [ADR-002](adr-002.md)
Доставка сообщений рассылки до адресатов выполняется с использованием внешних сервисов [ADR-007](adr-007.md)

### Диаграмма компонентов (C3):

![C3](static/c3.svg)
Компоненты системы, не относящиеся к "коробочному" ПО, будут реализованы с использованием ASP .Net [ADR-008](adr-008.md)
Приём сообщений для рассылки и настройка подсистемы выполняется при помощи API шлюза, который перенаправляет сообщения входному прокси системы, настройки и прочие данные - сервису управления данными. Шлюз обеспечивает авторизацию доступа к подсистеме, единую точку входа [ADR-009](adr-009.md)
Сервис управления данными (паттерн компонента: кэширующий прокси) реализует операции с данными, доступ к ним с кэшированием. СУБД периодически сохраняет резервные копии базы данных
Входной прокси-сервис (паттерн компонента: прокси) перемещает сообщения для рассылки в топик брокера для входящих сообщений, добавляя необходимые метаданные (время приема и т.п.), откуда их получает сервис распределения (паттерн компонента: мультиплексор), получает от сервиса управления данными настройки рассылки, формирует сообщение для рассылки и помещает его в топик, соответствующий каналу оповещения, брокера сообщений.
Сервисы, обеспечивающее подготовку задания для внешнего сервиса каждого канала рассылки (паттерн компонента: посредник), получают данные из соответствующих топиков и реализуют необходимые интеграционные сценарии, с учетом ограничений каналов рассылки [ADR-010](adr-010.md)
Сервис мониторинга, на основе метрик состояния топиков брокера сообщений, ставит задачу оркестратору на горизонтальное масштабирование подсистемы за счет создания дополнительных реплик сервисов распределения, работы с сервисами каналов [ADR-011](adr-011.md)



