# Технический проект "Сервис отправки оповещений"

> Это фрагмент Технического проекта, который нужно заполнить в рамках практического задания темы "Технический проект".
---

## Текущая архитектура

В текущей архитектуре у нас есть мобильное приложение, которое общается с компонентом "Controller", а он в свою очередь делает запросы к "Foo" и "Bar".

![alt text](static/current_arch.svg)


## Целевая архитектура

### Диаграмма контекста (C1):
![C1](static/c1.svg)

Предполагается, что любой из существующих компонентов может отправить оповещение пользователю. При этом существующие каналы связи и предпочтения по их использованию известны системе оповещений, компоненты остальной системы знать это не должны.

### Диаграмма контейнеров (C2):
![C2](static/c2.svg)

Основываясь на данных из [README](README.md) и урока `Спринт 2/6 → Тема 3/4: Создание технического проекта → Урок 11/12` было предложено след.:
* использование архитектуры, основанной на компонентах (см. [ADR_1](ADR/ADR_1.md));
* точкой входа в "сервис отправки оповещений" является API Gateway (см. [ADR_2](ADR/ADR_2.md));
* для хранения настроек по каждому каналу связи для рассылки уведомлений использовать PostgreSQL (см. [ADR_3](ADR/ADR_3.md));
* в качестве брокера сообщений использовать RabbitMQ (см. [ADR_4](ADR/ADR_4.md));
* для сбора метрик использовать связку [grok_exporter](https://github.com/fstab/grok_exporter) + Prometheus (см. [ADR_5](ADR/ADR_5.md));
* "Сервис рассылки оповещений" реализовать на Python3+FastAPI (см. [ADR_6](ADR/ADR_6.md));
* "Сервисы для отправки *" реализовывать на Python3 (см. [ADR_7](ADR/ADR_7.md)).

Решения принятые выше (ADR_1-7) основывались на след.:
* лучше использовать известные решения, т.к. найм новых сотрудников сильно скажется на сроках и бюджете\
  (поставленная задача неплохо ложится на имеющийся стек компании)
* лучше использовать open source решения, т.к. политическая ситуация в мире показала что вендоры могут моментально уйти не соблюдая никаких договоренностей\
  (существующие open source решения позволяют реализовать поставленную задачу)

План реализации:
* в компании уже есть инфраструктурное подразделение, которое предоставит 
  * место в gitlab для разработки ПО 
    * \+ runner'ы для CI
    * \+ registry для хранения docker image
  * БД/[PostgreSQL](https://www.postgresql.org)
  * брокер сообщений/[RabbitMQ](https://www.rabbitmq.com)
  * [Prometheus](https://prometheus.io), в котором уже будут метрики из пунктов выше
* команда, которая будет разрабатывать данный сервис должна
  * настроить БД (создать необходимые таблицы)
  * настроить брокер сообщений (создать необходимые очереди)
  * написать сервисы `сервис рассылки оповещений` и `сервис для отправки *`
  * настроить конфиги для [grok_exporter](https://github.com/fstab/grok_exporter) 
  * собрать отдельные docker image (в отдельном image будет сервис и grok_exporter)
    * важно: image должны быть минимального размера
  * прийти с запросом в инфраструктурное подразделение, которое развернет эти image в Kubernetes

### Диаграмма компонентов (C3):
![C3](static/c3.svg)
(примечание: на данной диаграмме умышленно отсутствует логирование)
