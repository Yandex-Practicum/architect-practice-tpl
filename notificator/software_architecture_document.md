# Технический проект "Сервис отправки оповещений"

> Это фрагмент Технического проекта, который нужно заполнить в рамках практического задания темы "Технический проект".
---

## Текущая архитектура

В текущей архитектуре у нас есть мобильное приложение, которое общается с компонентом "Controller", а он в свою очередь делает запросы к "Foo" и "Bar".

![alt text](static/current_arch.svg)


## Целевая архитектура

### Диаграмма контекста (C1):
![C1](static/c1.svg)

Предполагается, что любой из существующих компонентов может отправить оповещение пользователю. При этом существующие каналы связи и предпочтения по их использованию известны системе оповещений, компоненты остальной системы знать это не должны.

### Диаграмма контекста (C2):
![C1](static/с2.svg)

В системе планируется использовать брокер сообщений [RabbitMq](static/adr/adr-001.md)
Благодаря ему, мы сможем достигнуть асинхронной обработки сообщений 
и повысим надежность нашей системы. В качестве базы данных будет использоваться PostgreSQL, сервису необходимо
использовать условия по выборке данных, так же она бесплатная и проста в использовании и поддержке.

Авторизация и аутентификация происходит через [Keycloak identity-provider](static/adr/adr-002.md).
Предполагает меньше затрат на создание и поддержку сервиса,
так как обладает всем необходимым функционалом и легко интегрируется с различными системами.

Перед очередью сообщений добавлен слой Middleware (System) для валидаций схем сообщений для различных уведомлений.

### Диаграмма контекста (C3):
![C1](static/с3.svg)

Внешние системы должны регистрировать себя в приложении уведомлений, так же после регистрации добавлять своих пользователей в систему для 
будущей выборки по отправке сообщений(Чтобы другие пользователи не получали лишних уведомлений)
Внешней системе так же доступна настройка(включение/отключение) видов уведомлений которые она предоставляет(Смс, email, push) их количество(Если есть ограничение по кол-ву).

После регистрации, внешняя система может получить необходимые схемы в формате JSON, для разных уведомлений.

Добавлен API администратора, сервису нужен контроль со стороны. Для загрузки и редактирования шаблонов сообщений(JSON Schema) и управление приложением.
В частности частота отправки различных уведомлений, максимальное количество уведомлений.

В системе предусмотренна пользовательская настройка уведомлений, только нужных пользователю систем и их доступных видов сообщений.

Все сообщения обрабатываются в зависимости от правил шаблонов(Смс, email, push).

Предусмотренно два обменника, один для необработанных сообщений(сторонние системы),
второй для форматированных сообщений по шаблонам, подготовленных к отправке в сервисы уведомлений.

Контейнеры с [Keycloak identity-provider](static/adr/adr-002.md) и [RabbitMq](static/adr/adr-001.md) 
полностью с готовым функционалом, вследствие этого они **не** будут отображаться на с3 диаграмме.

Балансировщики нагрузок, реплики очередей и базы данных при необходимости будут отражены на диаграмме развертывания.

