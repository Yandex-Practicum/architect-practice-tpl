#### ID: ADR-004

#### Дата: 2023.10.07

#### Статус: Предложено

#### Участники:
* Абдрахманов Марат

#### Решения:
* Для хранения пользовательских настроек по каждому каналу связи, данных пользователей и регламентов рассылок используется хранилище "Параметры отправителей и регламентных рассылок".
* Для хранения всех выполненных рассылок используется хранилище "БД хранения рассылок".
* За управление формированием уведомлений отвечает Notify Service, в части:
    * Принимает от API Gateway через брокер (топик new_notify):
        * Пользовательские настройки по каждому каналу связи для рассылки уведомлений и сохраняет их в хранилище "Параметры отправителей и регламентных рассылок".
        * Задание на отправку уведомлений (одиночных и регламентных).
    * Отправляет задание на рассылку уведомлений по заданному регламенту (периодически, единоразово) в брокер в топик send_notify.
    * Информацию по каждой отправленной рассылке фиксирует в хранилище "БД хранения рассылок".
    
#### Контекст:
Согласно ТЗ необходимо принимать от пользователя системы настройки по каждому каналу связи для рассылки уведомлений (вкл/выкл, адрес/номер/логин) и учитывать эти настройки при последующих рассылках. Также считаю, что необходимо сохранять информацию о каждой отправленной рассылке.

В рамках данного ADR описано решение для:
- Процесса сохранения параметров настройки по каждому каналу связи для рассылки уведомлений.
- Процесса сохранения информации об отправленных запросах.
- Процесса рассылки одиночного оповещения.
- Процесса рассылки оповещений по заданному регламенту (с определенным периодом).

#### Последствия:

#### Положительные:
* Использование отдельных хранилищ для настроек и для фиксации посылок в будущем позволит более гибко ими управлять в части доступа и расширения (м.б. потребуется шардировать "БД хранения рассылок").
* Ограничение Notify Service только бизнес-задачами соответствует хорошим практикам проектирования, в частности принцип единой ответственности, и потребует меньше ресурсов на сопровождение кодовой базы. 
* Упрощение тестирования Notify Service'а.

#### Отрицательные:
* Дополнительные ресурсы на сопровождение двух хранилищ вместо одного.